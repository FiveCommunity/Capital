config.attachs = {
   
    --[ PISTOLAS ]==============================================================

    ['WEAPON_COMBATPISTOL'] = {   
        ['clip'] = 'COMPONENT_COMBATPISTOL_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_PI_SUPP',
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_PI_FLSH',
        ['scope'] = nil,
        ['grip'] = nil,
    },

    ['WEAPON_PISTOL_MK2'] = { 
        ['clip'] = 'COMPONENT_PISTOL_MK2_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_PI_SUPP_02',
        ['compensator'] = 'COMPONENT_AT_PI_COMP',
        ['flashlight'] = 'COMPONENT_AT_PI_FLSH_02',
        ['scope'] = 'COMPONENT_AT_PI_RAIL',
        ['grip'] = nil,
    },

    ['WEAPON_PISTOL'] = {   
        ['clip'] = 'COMPONENT_PISTOL_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_PI_SUPP_02',
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_PI_FLSH',
        ['scope'] = nil,
        ['grip'] = nil,
    },

    ['WEAPON_CERAMICPISTOL'] = {  
        ['clip'] = 'COMPONENT_CERAMICPISTOL_CLIP_02',
        ['suppressor'] = 'COMPONENT_CERAMICPISTOL_SUPP',
        ['compensator'] = nil,
        ['flashlight'] = nil,
        ['scope'] = nil,
        ['grip'] = nil,
    },

    ['WEAPON_SNSPISTOL_MK2'] = {
        ['clip'] = 'COMPONENT_SNSPISTOL_MK2_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_PI_SUPP_02',
        ['compensator'] = 'COMPONENT_AT_PI_COMP_02',
        ['flashlight'] = 'COMPONENT_AT_PI_FLSH_03',
        ['scope'] = 'COMPONENT_AT_PI_RAIL_02',
        ['grip'] = nil,

    },

    ['WEAPON_SNSPISTOL'] = {
        ['clip'] = 'COMPONENT_SNSPISTOL_CLIP_02',
        ['suppressor'] = nil,
        ['compensator'] = nil,
        ['flashlight'] = nil,
        ['scope'] = nil,
        ['grip'] = nil,
    },

    ['WEAPON_REVOLVER_MK2'] = {
        ['clip'] = 'COMPONENT_SNSPISTOL_CLIP_02',
        ['suppressor'] = nil,
        ['compensator'] = 'COMPONENT_AT_PI_COMP_03',
        ['flashlight'] = 'COMPONENT_AT_PI_FLSH',
        ['scope'] = nil,
        ['grip'] = nil,
    },

    -- ['WEAPON_REVOLVER'] -- nenhum attachs

    ['WEAPON_PISTOL50'] = {
        ['clip'] = 'COMPONENT_PISTOL50_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP_02',
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_PI_FLSH',
        ['scope'] = nil,
        ['grip'] = nil,
    },

    -- ['WEAPON_DOUBLEACTION'] -- nenhum attachs
    
    --[ SMGS ]==================================================================
    

    ['WEAPON_GUSENBERG'] = {
        ['clip'] = 'COMPONENT_GUSENBERG_CLIP_02',
        ['suppressor'] = nil,
        ['compensator'] = nil,
        ['flashlight'] = nil,
        ['scope'] = nil,
        ['grip'] = nil,
    },

    ['WEAPON_SMG_MK2'] = {
        ['clip'] = 'COMPONENT_SMG_MK2_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_PI_SUPP',
        ['compensator'] = 'COMPONENT_AT_MUZZLE_01',
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_SMALL_SMG_MK2',
        ['grip'] = nil,
    },

    ['WEAPON_ASSAULTSMG'] = {
        ['clip'] = 'COMPONENT_ASSAULTSMG_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP_02',
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_MACRO',
        ['grip'] =  nil,
    },

    ['WEAPON_MACHINEPISTOL'] = {
        ['clip'] = 'COMPONENT_MACHINEPISTOL_CLIP_03',
        ['suppressor'] = 'COMPONENT_AT_PI_SUPP',
        ['compensator'] = nil,
        ['flashlight'] = nil,
        ['scope'] = nil,
        ['grip'] = nil,
    },

    ['WEAPON_MINISMG'] = {
        ['clip'] = 'COMPONENT_MINISMG_CLIP_02',
        ['suppressor'] = nil,
        ['compensator'] = nil,
        ['flashlight'] = nil,
        ['scope'] = nil,
        ['grip'] = nil,
    },

    ['WEAPON_COMBATPDW'] = {
        ['clip'] = 'COMPONENT_COMBATPDW_CLIP_03',
        ['suppressor'] = nil,
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_SMALL',
        ['grip'] = 'COMPONENT_AT_AR_AFGRIP',
    },

    ['WEAPON_MICROSMG'] = {
        ['clip'] = 'COMPONENT_MICROSMG_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP_02',
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_PI_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_MACRO',
        ['grip'] = nil,
    },

    --[ ARs ]===================================================================

    ['WEAPON_ASSAULTRIFLE'] = {
        ['clip'] = 'COMPONENT_ASSAULTRIFLE_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP_02',
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_MACRO',
        ['grip'] = 'COMPONENT_AT_AR_AFGRIP',
    },
    
    ['WEAPON_ASSAULTRIFLE_MK2'] = {
        ['clip'] = 'COMPONENT_ASSAULTRIFLE_MK2_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP_02',
        ['compensator'] = 'COMPONENT_AT_MUZZLE_01',
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_MEDIUM_MK2',
        ['grip'] = 'COMPONENT_AT_AR_AFGRIP_02',
    },

    ['WEAPON_SPECIALCARBINE_MK2'] = {
        ['clip'] = 'COMPONENT_SPECIALCARBINE_MK2_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP_02',
        ['compensator'] = 'COMPONENT_AT_MUZZLE_01',
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_MEDIUM_MK2',
        ['grip'] = 'COMPONENT_AT_AR_AFGRIP_02',
    },

    ['WEAPON_BULLPUPRIFLE_MK2'] = {
        ['clip'] = 'COMPONENT_BULLPUPRIFLE_MK2_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP',
        ['compensator'] = 'COMPONENT_AT_MUZZLE_01',
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_SMALL_MK2',
        ['grip'] = 'COMPONENT_AT_AR_AFGRIP_02',
    },

    ['WEAPON_HEAVYRIFLE'] = {
        ['clip'] = 'COMPONENT_HEAVYRIFLE_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP',
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_MEDIUM',
        ['grip'] = 'COMPONENT_AT_AR_AFGRIP',
    },

    ['WEAPON_CARBINERIFLE_MK2'] = {
        ['clip'] = 'COMPONENT_CARBINERIFLE_MK2_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP',
        ['compensator'] = 'COMPONENT_AT_MUZZLE_01',
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_MEDIUM_MK2',
        ['grip'] = 'COMPONENT_AT_AR_AFGRIP_02',
    },

    ['WEAPON_SPECIALCARBINE'] = {
        ['clip'] = 'COMPONENT_SPECIALCARBINE_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP_02',
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_MEDIUM',
        ['grip'] = 'COMPONENT_AT_AR_AFGRIP',
    },
    
    -- ['WEAPON_MINIGUN'] -- nenhum attachs

    ['WEAPON_TACTICALRIFLE'] = {
        ['clip'] = 'COMPONENT_TACTICALRIFLE_CLIP_02',
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP_02',
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH_REH',
        ['scope'] = nil,
        ['grip'] = 'COMPONENT_AT_AR_AFGRIP',
    },

    --[ SHOTGUNS ]==============================================================

    ['WEAPON_PUMPSHOTGUN'] = {
        ['clip'] = nil,
        ['suppressor'] = 'COMPONENT_AT_SR_SUPP',
        ['compensator'] = nil,
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = nil,
        ['grip'] = nil,
    },
    
    ['WEAPON_PUMPSHOTGUN_MK2'] = {
        ['clip'] = nil,
        ['suppressor'] = 'COMPONENT_AT_SR_SUPP_03',
        ['compensator'] = 'COMPONENT_AT_MUZZLE_08',
        ['flashlight'] = 'COMPONENT_AT_AR_FLSH',
        ['scope'] = 'COMPONENT_AT_SCOPE_SMALL_MK2',
        ['grip'] = nil,
    },
    
    -- ['WEAPON_SAWNOFFSHOTGUN'] -- nenhum attachs

    -- ['WEAPON_DBSHOTGUN'] -- nenhum attachs
    
    -- ['WEAPON_MUSKET'] -- nenhum attachs

    --[ SNIPERS ]===============================================================

    ['WEAPON_SNIPERRIFLE'] = {
        ['clip'] = nil,
        ['suppressor'] = 'COMPONENT_AT_AR_SUPP_02',
        ['compensator'] = nil,
        ['flashlight'] = nil,
        ['scope'] = 'COMPONENT_AT_SCOPE_MAX',
        ['grip'] = nil,
    },


    -- exemplo
    ['WEAPON_NAMENAMENAME'] = {
        ['clip'] = 'W_COMPONENT',
        ['suppressor'] = 'W_COMPONENT',
        ['compensator'] = 'W_COMPONENT',
        ['flashlight'] = 'W_COMPONENT',
        ['scope'] = 'W_COMPONENT',
        ['grip'] = 'W_COMPONENT',
    },
       
}

local attachsReference = {
    ['clip-extendido'] = 'clip',
    ['supressor'] = 'suppressor',
    ['compensador'] = 'compensator',
    ['lanterna-acoplavel'] = 'flashlight',
    ['mira-avancada'] = 'scope',
    ['grip-avancado'] = 'grip',
}

config.itemFunctions['type:attachs'] = function(source, user_id, item, amount, slot, UserInventory)

    local newComponent = attachsReference[item]
    if newComponent then
   
        local stateBag = PlayerState(source)
        local currentWeapon = stateBag['weapon_model']
        local currentSlot = stateBag['weapon_slot']
        
        if currentWeapon and currentSlot then

            if config.attachs[currentWeapon][newComponent] then

                local weapData = UserInventory:getSlot(currentSlot)
                local hasComponent = false
                
                if (not weapData.attachs) then weapData.attachs = {}; end;
                
                for k, v in ipairs(weapData.attachs) do
                    if (v == newComponent) then hasComponent = true; break; end;
                end

                if (not hasComponent) then
                    if UserInventory:tryGetItem(item,1,slot) then
                        
                        table.insert(weapData.attachs,newComponent)
                        UserInventory:setSlotKey(currentSlot,'attachs',weapData.attachs)
                        TriggerClientEvent('inventory:attachs',source,currentWeapon,weapData.attachs)

                        TriggerClientEvent('Notify', source, 'sucesso', 'Attachs', 'Já possui um componente deste equipado!')
                    end
                else
                    TriggerClientEvent('Notify', source, 'aviso', 'Attachs', 'Já possui um componente deste equipado!')
                end
            else
                TriggerClientEvent('Notify', source, 'negado', 'Attachs', 'Esta arma não tem encaixes para este componente!')
            end
        else
            TriggerClientEvent('Notify', source, 'negado', 'Attachs', 'Tenha uma arma em mãos para usar este item!')
        end

    end
end

if IsDuplicityVersion() then
    local tasking = {}
    RegisterNetEvent('gb_interactions:detach', function()
        local source = source
        local user_id = vRP.getUserId(source)
        if (user_id) then

            if (not vRP.hasPermission(user_id, "policia.permissao")) then
                TriggerClientEvent('Notify', source, 'negado', 'Attachs', 'Sem permissão!')
                return
            end

            if (tasking[source]) then return; end;
            tasking[source] = true
            
            local stateBag = PlayerState(source)
            local currentWeapon = stateBag['weapon_model']
            local currentSlot = stateBag['weapon_slot']
            
            if currentWeapon and currentSlot then

                local UserInventory = vRP.PlayerInventory(user_id)
                if UserInventory then

                    local weapData = UserInventory:getSlot(currentSlot)    
                    if (not weapData.attachs) then weapData.attachs = {}; end;

                    if (#weapData.attachs > 0) then

                        if UserInventory:haveSpace('clip-extendido', #weapData.attachs) then             
                            
                            for idx, comp in ipairs(weapData.attachs) do      
                                for item, alias in pairs(attachsReference) do           
                                    if (comp == alias) then
                                        UserInventory:generateItem(item,1,nil,{ prefix = 'EB' },true)
                                        break;
                                    end
                                end
                            end

                        else
                            TriggerClientEvent('Notify', source, 'negado', 'Attachs', 'Sem espaço para os Componentes!')
                        end

                        UserInventory:setSlotKey(currentSlot, 'attachs', nil)
                        TriggerClientEvent('inventory:attachs', source, currentWeapon, nil)
                    else
                        TriggerClientEvent('Notify', source, 'negado', 'Attachs', 'Esta arma não possui Componentes para remover!')
                    end
                end
            else
                TriggerClientEvent('Notify', source, 'negado', 'Attachs', 'Fique com a arma em mão para remover os Componentes!')
            end

            tasking[source] = nil
        end
    end)
end